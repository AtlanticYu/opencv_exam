<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>基于opencv的答题卡识别判卷--demo</title>
    <link href="/static/css/layui.css" rel="stylesheet">
    <script src="/static/jquery-3.2.1.min.js"></script>
    <script src="/static/layui.all.js"></script>
</head>

<body>




    <div class="fly-header layui-bg-black">
        <div class="layui-container">
            <ul class="layui-nav fly-nav layui-hide-xs">
                <li class="layui-nav-item"> <a href="/"><i class="iconfont icon-jiaoliu"></i>识别答题卡</a> </li>
                <li class="layui-nav-item" style="float: right;">
                    <a href="javascript:;"><i class="layui-icon layui-icon-username"></i> <span id="username"></span></a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;" id="logout">退出登录</a></dd>
                    </dl>
                </li>
            </ul>

        </div>
    </div>




















    <div class="layui-container" style="margin-top: 10px;">
        <div class="jumbotron">
            <div class="container"
                style="background-color: #F8F8F8;border-radius: 10px ;padding: 20px;padding-top: 10px;">
                <form action="javascript:void(0)" method="post" enctype="multipart/form-data" id="predict"
                    class="layui-form layui-col-xs8">

                    <br><br>
                    <div class="layui-form-item">
                        <label class="layui-form-label">选择文件</label>
                        <div class="layui-input-block">
                            <input type="file" name="image" required lay-verify="required" autocomplete="off"
                            onchange="onUpload1(this.files[0])"
                                class="layui-input">
                        </div>
                    </div>
                    <br>
                    <div style="height: 600px;width: 350px;float: left;">预览:
                        <img src="#" id="predict-img"
                            style="height: 500px;width: 300px;border: dimgray solid 1px;display: block;" alt="">
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">模式</label>
                        <div class="layui-input-block">
                          <select name="method" lay-verify="required">
                            <option value="com">阅卷</option>
                            <option value="set">设置正确答案</option>
                           
                            
                          </select>
                        </div>
                      </div>



                    <button type="submit" class="layui-btn layui-btn-info" style="margin-top: 20px;">提交识别</button>

                </form>


                <br><br><br>
                <hr>
                <br>
                <h3>识别结果</h3>
                <div id="predict-body" style="min-height: 50px;">

                </div>
              

            </div>

        </div>
     
    </div>   <div id="table"></div>


    <script src="/static/jquery-3.2.1.min.js"></script>

    <script type="text/javascript">
        // Cookie操作函数
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }
        
        function deleteCookie(name) {
            document.cookie = `${name}=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT`;
        }

        layui.use(['element', 'layer', 'form'], function(){
            var element = layui.element;
            var layer = layui.layer;
            var form = layui.form;
            
            // 显示用户名
            var username = getCookie('user');
            if(username) {
                // $('#username').text(username);
                $('#username').text("张老师");
            }
            
            // 为用户图标添加点击事件
            $('.layui-nav-item a[href="javascript:;"]').click(function(){
                layer.confirm('确定要退出登录吗？', {
                    btn: ['确定','取消'],
                    icon: 3,
                    title: '提示'
                }, function(index){
                    deleteCookie('user');
                    layer.msg('已退出登录', {
                        icon: 1,
                        time: 1000,
                        shade: 0.3,
                        shadeClose: true
                    }, function(){
                        window.location.href = '/login';
                    });
                    layer.close(index);
                });
            });

            table = layui.table;
            layui.form.render();
        });

        $("button").click(function () {


            $("#predict-body").html(' ');

            $.ajax({
                type: "post",
                data: new FormData($('#predict')[0]),
                cache: false,
                dataType: "json",
                processData: false,
                contentType: false,
                success: function (ret) {
                    if (ret.code === 200) {
                        $("#predict-body").html(
                            `<h3>准考证:${ret.number}</h3>
                            <br>
                            <p>经程序自动识别阅卷 该学生错误题数:${ret.error} 本轮考试得分:${140-ret.error}</p>  
                            
                            `
                        )

                        table.render({
                            elem: '#table'

                            , data: ret.answer
                            , page: false //开启分页
                            , cols: [[ //表头
{field: '0'},
{field: '1'},
{field: '2'},
{field: '3'},
{field: '4'},
{field: '5'},
{field: '6'},
{field: '7'},
{field: '8'},
{field: '9'},
{field: '10'},
{field: '11'},
{field: '12'},
{field: '13'},
{field: '14'},
{field: '15'},
{field: '16'},
{field: '17'},
{field: '18'},
{field: '19'},
                            

                            ]]
                        });












                    } else { layui.layer.msg(ret.msg) }


                    console.log(ret)
                }, error: function (rel) {
                    alert("服务器错误!可能是由于您输入的参数不规范")
                }

            })
        });









        function onUpload1(file) {
            var fr = new FileReader();
            fr.readAsDataURL(file);  // 将文件读取为Data URL

            fr.onload = function (e) {
                var result = e.target.result;
                $("#predict-img").attr("src", result)
            }
        }
        $("#submit-comment").click(function(){
            $.ajax({url:"/comment/",
            type:"post",data:{
                "text":$("#comment-text").val(),
                "method":"insert"

            },dataType:"json",success:function(rel){
layui.layer.msg("完成评论!")
            }})









        });

        // 退出登录
        $('#logout').click(function(){
            deleteCookie('user');
            window.location.href = '/login';
        });

    </script>
</body>

</html>